{% extends 'base.html' %}
{% block content %}
  <div class="page-card">
      <div class="page-title">
      <h2>Ride Listings</h2>
      <div style="display:flex;gap:12px;align-items:center;">
        <form class="search-form" method="get" action="{{ url_for('main.listings') }}">
          <input class="search-input" name="q" placeholder="Search by destination (e.g. 'Airport')" value="{{ q or '' }}">
          <button class="search-btn" type="submit">Search</button>
        </form>
        <div class="muted">Showing {{ pools|length }} results</div>
      </div>
      </div>

    {% if pools %}
      <div class="listings-grid">
        {% for p in pools %}
          <article class="card">
            <div class="card-body">
              <div class="card-title">{{ p.title }}</div>
              <div class="card-route">{{ p.origin }} &rarr; {{ p.destination }}</div>

              {# show who posted (inline, not as a pill) #}
              <div class="card-posted">Posted by: {{ (p.owner.full_name or p.owner.username) if p.owner else 'Unknown' }}</div>

              <div class="card-meta">
                {% if p.depart_time %}
                  <div class="pill">Depart: {{ p.depart_time.strftime('%b %d, %Y %I:%M %p') }}</div>
                {% else %}
                  <div class="pill">Depart: TBD</div>
                {% endif %}
                <div class="pill">Seats: {{ p.seats }}</div>
                {# Show estimated travel time and arrival if available #}
                {% if p.eta_human_display %}
                  <div class="pill">Est travel: {{ p.eta_human_display }}</div>
                  {% if p.eta_arrival_display %}
                    <div class="pill">Arrive: {{ p.eta_arrival_display.strftime('%b %d, %Y %I:%M %p') }}</div>
                  {% endif %}
                {% elif p.eta_human %}
                  <div class="pill">Est travel: {{ p.eta_human }}</div>
                  {% if p.eta_arrival %}
                    <div class="pill">Arrive: {{ p.eta_arrival.strftime('%b %d, %Y %I:%M %p') }}</div>
                  {% endif %}
                {% endif %}
                {# Per-request: remove "From your pickup" and "Leave by" pills to reduce clutter #}
                {# Show cost information (estimates) #}
                {% if p.cost_per_rider is defined and p.cost_per_rider is not none %}
                  <div class="pill">Cost: ${{ '%.2f'|format(p.cost_per_rider) }}</div>
                {% endif %}
              </div>

              {% if p.description %}
                <div class="card-desc">{{ p.description }}</div>
              {% endif %}
            </div>
            <div class="card-footer" style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
              <small class="muted">Posted {{ p.created_at.strftime('%b %d') }}</small>
              <div>
                <a class="btn" href="{{ url_for('main.pool_detail', pool_id=p.id) }}">View / Request</a>
              </div>
            </div>
          </article>
        {% endfor %}
      </div>
      <div style="margin-top:18px; display:flex; justify-content:center;">
        {% if next_page %}
          <a class="btn" href="{{ url_for('main.listings', q=q, page=next_page) }}">Show more</a>
        {% endif %}
      </div>
    {% else %}
      <p>No current listings.</p>
    {% endif %}
  </div>
{% endblock %}
